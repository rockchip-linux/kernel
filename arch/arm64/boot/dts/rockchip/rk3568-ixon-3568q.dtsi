wdt// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * Copyright (c) 2020 Rockchip Electronics Co., Ltd.
 *
 */

#include "rk3568-firefly-port.dtsi"

/ {

	usb2_hub_reset: usb2-hub-reset-regulator {
		compatible = "regulator-fixed";
		enable-active-high;
		gpio = <&gpio0 RK_PA6 IRQ_TYPE_EDGE_FALLING>;
		regulator-name = "usb2_hub_reset_n";
		regulator-always-on;
	};

	usb3_hub_reset: usb3-hub-reset-regulator {
		compatible = "regulator-fixed";
		enable-active-high;
		gpio = <&gpio0 RK_PA5 IRQ_TYPE_EDGE_FALLING>;
		regulator-name = "usb3_hub_reset_n";
		regulator-always-on;
	};
};

&csi2_dphy0 {
	status = "disabled";
};

&csi2_dphy1 {
	status = "disabled";
	/*
	* dphy1 only used for split mode,
	* can be used  concurrently  with dphy2
	* full mode and split mode are mutually exclusive
	*/
};

&csi2_dphy2 {
	status = "disabled";
	/*
	* dphy2 only used for split mode,
	* can be used  concurrently  with dphy1
	* full mode and split mode are mutually exclusive
	*/
};

&rkisp_vir0 {
	status = "disabled";
};

&rkisp_vir1 {
	status = "disabled";
};

&i2c0 {
    status = "okay";
    sensor@3c{
        status = "okay";
        compatible = "firefly,pc9202";
        reg = <0x3c>;
        //wd-en-gpio = <&gpio3 23 GPIO_ACTIVE_HIGH>;
    };
};

&i2c1 {
	status = "okay";
	rv3028@52 {
		status = "okay";
		compatible = "microcrystal,rv3028";
		reg = <0x52>;
		trickle-resistor-ohms = <3000>;
	};
	tpm@2e {
		status = "okay";
		compatible = "infineon,slb9673", "tcg,tpm-tis-i2c";
		reg = <0x2e>;
	};

	/delete-node/ xc6130@23;
};

&i2c2{
	status = "disabled";
	pinctrl-0 = <&i2c2m1_xfer>;
};

&i2c4{
	status = "disabled";
};

&vcc_camera {
	status = "disabled";
};

&pwm11 {
	status = "disabled";
};

&pwm14 {
	status = "disabled";
};

&i2c5 {
    status = "disabled";
    /delete-node/ hym8563@51;
	/delete-node/ mxc6655xa;
};

&mc3230 {
    status = "disabled";
};

&pca9555 {
    status = "disabled";
};

&uart9 {
	pinctrl-names = "default";
	pinctrl-0 = <&uart9m1_xfer>;
	status = "disabled";
};

&uart3 {
	pinctrl-names = "default";
	pinctrl-0 = <&uart3m0_xfer>;
	status = "okay";
};

&uart0 {
	status = "okay";
};

&pcie30phy {
       status = "okay";
};

&spi1 {
	status = "disabled";
	/delete-property/ pinctrl-0;
	/delete-property/ pinctrl-1;
	/delete-property/ spi_wk2xxx;
};

&spi3 {
	status = "okay";
	max-freq = <48000000>;
	pinctrl-0 = <&spi3m1_pins>;
	pinctrl-1 = <&spi3m1_cs0>;

	#address-cells = <1>;
	#size-cells = <0>;

	display: display@0{
		// MIPI DBI compatible driver
		// This driver is used because it can ignore an illegal rotate value
		// and doesn't have a set_gamma() function.
		compatible = "samsung,s6d02a1";
		reg = <0>; // Chip Select 0

		spi-max-frequency = <32000000>; // 32MHz

		pinctrl-0 = <&display_pins>;
		reset-gpios = <&gpio3 RK_PA1 GPIO_ACTIVE_LOW>; // reset is active low hence the 1
		dc-gpios = <&gpio0 RK_PB6 GPIO_ACTIVE_LOW>;
		led-gpios = <&gpio3 RK_PC5 GPIO_ACTIVE_LOW>;

		width = <240>;
		height = <240>;
		buswidth = <8>; // Most controllers use this value

		// This is a hack to prevent fb_s6d02a1.c:set_var() from issuing
		// command 0x36 after the init sequence has been applied and thus
		// changing the config.
		rotate = <1>;

		// see drivers/staging/fbtft/fb_ili9341.c:init_display() for how this looks in the driver
		// Command 0x36 is taken from the fb_ili9341.c:set_var() function.
		init = <0x1000001
			0x2000005
			0x1000028
			0x10000cf 0x00 0x83 0x30
			0x10000ed 0x64 0x03 0x12 0x81
			0x10000e8 0x85 0x01 0x79
			0x10000cb 0x39 0x2c 0x00 0x34 0x02
			0x10000f7 0x20
			0x10000ea 0x00 0x00
			0x10000c0 0x26
			0x10000c1 0x11
			0x10000c5 0x35 0x3e
			0x10000c7 0xbe
			0x100003a 0x55
			0x1000036 0x28
			0x10000b1 0x00 0x1b
			0x1000026 0x01
			0x10000f2 0x08
			0x1000026 0x01
			0x10000e0 0x1f 0x1a 0x18 0x0a 0x0f 0x06 0x45 0x87 0x32 0x0a 0x07 0x02 0x07 0x05 0x00
			0x10000e1 0x00 0x25 0x27 0x05 0x10 0x09 0x3a 0x78 0x4d 0x05 0x18 0x0d 0x38 0x3a 0x1f
			0x10000b7 0x07
			0x10000b6 0x0a 0x82 0x27 0x00
			0x1000011
			0x2000064
			0x1000029
			0x2000064>;

		debug = <0x4000000>; // print init commands to the kernel log
	};
};

&pcie3x2 {
    status = "okay";
};

&its {
    status = "okay";
};

&can1 {
    status = "disabled";
};

&can2 {
    status = "disabled";
};

/delete-node/ &vcc3v3_vga;

&gmac0 {
	/delete-property/ phy-handle;
    status = "okay";
	tx_delay = <0x4f>;
	rx_delay = <0x0f>;
// 	snps,reset-gpio = <&gpio0 RK_PD5 GPIO_ACTIVE_LOW>;
// 	snps,reset-gpio = <&gpio2 RK_PD2 GPIO_ACTIVE_LOW>;

	clock_in_out = "output";
	assigned-clocks = <&cru SCLK_GMAC0_RX_TX>, <&cru SCLK_GMAC0>;
	assigned-clock-rates = <0>, <125000000>;
	assigned-clock-parents = <&cru SCLK_GMAC0_RGMII_SPEED>;

	pinctrl-names = "default";
	pinctrl-0 = <&gmac0_gpio
			&gmac0_miim
			&gmac0_rx_bus2
			&gmac0_tx_bus2
			&gmac0_rgmii_bus
			&gmac0_rgmii_clk>;
	phy-mode = "rgmii";
	fixed-link {
		speed = <10>;
		full-duplex;
		pause;
	};
};

&gmac1 {
    status = "okay";
    tx_delay = <0x4d>;
    rx_delay = <0x2d>;
	snps,reset-gpio = <&gpio1 RK_PB0 GPIO_ACTIVE_LOW>;

	clock_in_out = "output";
	assigned-clocks = <&cru SCLK_GMAC1_RX_TX>, <&cru SCLK_GMAC1>;
	assigned-clock-rates = <0>, <125000000>;
	assigned-clock-parents = <&cru SCLK_GMAC1_RGMII_SPEED>;

	pinctrl-names = "default";
	pinctrl-0 = <&gmac1m1_miim
		     &gmac1m1_tx_bus2
		     &gmac1m1_rx_bus2
		     &gmac1m1_rgmii_clk
		     &gmac1m1_rgmii_bus>;
};

&mdio0 {
	#address-cells = <1>;
	#size-cells = <0>;

	rtl_switch: switch@0 {
		compatible = "realtek,rtl8365mb";
		reg = <0>;
		reset-gpios = <&gpio2 RK_PD2 (GPIO_ACTIVE_LOW|GPIO_OPEN_DRAIN)>;
		switch_intc: interrupt-controller {
			interrupt-parent = <&gpio3>;
			interrupts = <RK_PA3 IRQ_TYPE_LEVEL_LOW>;
			interrupt-controller;
			#address-cells = <0>;
			#interrupt-cells = <1>;
		};
		ports {
			#address-cells = <1>;
			#size-cells = <0>;

			port@0 {
				reg = <0>;
				label = "lan4";
			};

			port@1 {
				reg = <1>;
				label = "lan3";
			};

			port@2 {
				reg = <2>;
				label = "lan2";
			};

			port@3 {
				reg = <3>;
				label = "lan1";
			};

			port@6 {
				reg = <6>;
				label = "cpu";
				ethernet = <&gmac0>;
				phy-mode = "rgmii";
				fixed-link {
					speed = <10>;
					full-duplex;
				};
			};
		};
	};
};

&rgmii_phy0 {
	status = "disabled";
	led_status_value = <0x6940>;
};

&rgmii_phy1 {
	led_status_value = <0x6940>;
};

&uart8 {
	status = "disabled";
};

&sdio_pwrseq {
	status = "okay";
	reset-gpios = <&gpio3 RK_PD5 GPIO_ACTIVE_LOW>;
	post-power-on-delay-ms = <100>;
};

&wireless_bluetooth {
	BT,reset_gpio    = <&gpio1 RK_PB1 GPIO_ACTIVE_HIGH>;
	BT,wake_gpio     = <&gpio1 RK_PA4 GPIO_ACTIVE_HIGH>;
	BT,wake_host_irq = <&gpio1 RK_PB2 GPIO_ACTIVE_HIGH>;
	status = "disabled";
};

&spdif_8ch{
    status = "disabled";
};

&rk809_codec {
    spk-ctl-gpios = <&pca9555 PCA_IO0_7 GPIO_ACTIVE_HIGH>;
	/delete-property/ pinctrl-1;
    hp-ctl-gpios = <&gpio2 RK_PC1 GPIO_ACTIVE_HIGH>;
    hp-det-adc-value = <200>;
    hp-adc-drift-scope = <200>;
};

&rk809 {
    rtc {
        status = "disabled";
    };
};

&pwm7 {
	status = "disabled";
};

&sata1 {
	status = "okay";
};

&sata2 {
	status = "disabled";
	/delete-property/ pinctrl-0;
};

&pcie2x1 {
	status = "okay";
	pinctrl-0 = <&pcie20m1_pins>;
	pinctrl-1 = <&wlanen_pins>;
	reset-gpios = <&gpio3 RK_PC1 GPIO_ACTIVE_HIGH>;
};

&hdmi {
	status = "disabled";
};

&hdmi_in_vp0 {
	status = "disabled";
};

&hdmi_in_vp1 {
	status = "disabled";
};

&hdmi_sound {
	status = "disabled";
};

&dfi {
       status = "okay";
};

&dmc {
       status = "okay";
};

&pinctrl {

	gmac0 {
		gmac0_gpio: gmac0-gpio {
			rockchip,pins =
				/* gmac0_rst */
				<2 RK_PD2 RK_FUNC_GPIO &pcfg_pull_none>,
				/* gmac0_rst */
				<3 RK_PA3 RK_FUNC_GPIO &pcfg_pull_none>;
		};
	};

	pcie30x2 {
		pcie30x2m1_pins: pcie30x2m1-pins {
			rockchip,pins =
				/* pcie30x2_clkreqnm1 */
				<2 RK_PD4 4 &pcfg_pull_none>,
				/* pcie30x2_perstnm1 */
				<2 RK_PD6 4 &pcfg_pull_none>,
				/* pcie30x2_wakenm1 */
				<2 RK_PD5 4 &pcfg_pull_none>;
		};
	};

	pcie20x2 {
		wlanen_pins: wlanen_pins {
			rockchip,pins =
				/* pcie20_en */
				<4 RK_PD1 RK_FUNC_GPIO &pcfg_pull_up_drv_level_1>;
		};
	};

	display {
	display_pins: display_pins {
		rockchip,pins =
			<0 RK_PB6 RK_FUNC_GPIO &pcfg_pull_none>,
			<3 RK_PC5 RK_FUNC_GPIO &pcfg_pull_none>,
			<3 RK_PA1 RK_FUNC_GPIO &pcfg_pull_up_drv_level_1>;
		};
	};

};
